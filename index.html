<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Profit Pilot Pro</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <style>
        :root { --bg: #000000; --orange: #FF8C00; --red: #FF3B30; --green: #4CD964; --dark: #1C1C1E; --text: #FFFFFF; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; height: 100vh; overflow: hidden; }
        
        .weekly-tracker { display: flex; gap: 5px; margin: 10px 0 20px 0; width: 100%; justify-content: center; }
        .day-circle { width: 55px; height: 55px; border-radius: 12px; background: var(--dark); border: 2px solid #333; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 9px; cursor: pointer; transition: 0.2s; }
        .day-circle.active { border-color: var(--orange); box-shadow: 0 0 10px var(--orange); }
        .day-circle b { font-size: 11px; margin-top: 2px; }
        
        .day-circle.met { background: var(--green); color: #000; }
        .day-circle.failed { background: var(--red); color: #fff; }

        .main-container { position: relative; width: 280px; height: 280px; display: flex; align-items: center; justify-content: center; }
        #progress-ring { position: absolute; transform: rotate(-90deg); }
        .center-circle { width: 220px; height: 220px; border-radius: 50%; background: var(--red); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; z-index: 2; transition: 0.3s; }
        .center-circle.met { background: var(--green); color: #000; }

        .controls { display: flex; gap: 15px; width: 100%; max-width: 400px; margin-top: 30px; }
        button { flex: 1; padding: 20px; border-radius: 15px; border: none; font-weight: 800; font-size: 16px; }
        
        .btn-sale { background: var(--green); color: #000; }
        .btn-cost { background: var(--red); color: #fff; }
        
        .report-actions { display: flex; flex-direction: column; width: 100%; max-width: 400px; gap: 10px; margin-top: 20px; }
        .btn-report { background: transparent; border: 1px solid var(--orange); color: var(--orange); padding: 12px; border-radius: 10px; }
        .btn-reset { background: #222; color: #777; padding: 8px; font-size: 11px; border-radius: 8px; margin-top: 5px; }
        
        #viewing-label { color: var(--orange); font-size: 12px; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
        h1 { margin: 0; font-size: 38px; }
    </style>
</head>
<body>
    <div id="viewing-label">Viewing: Today</div>
    <div class="weekly-tracker">
        <div id="day-1" class="day-circle" onclick="switchDay(1)"><span>Mon</span><b id="val-1">£0</b></div>
        <div id="day-2" class="day-circle" onclick="switchDay(2)"><span>Tue</span><b id="val-2">£0</b></div>
        <div id="day-3" class="day-circle" onclick="switchDay(3)"><span>Wed</span><b id="val-3">£0</b></div>
        <div id="day-4" class="day-circle" onclick="switchDay(4)"><span>Thu</span><b id="val-4">£0</b></div>
        <div id="day-5" class="day-circle" onclick="switchDay(5)"><span>Fri</span><b id="val-5">£0</b></div>
        <div id="day-6" class="day-circle" onclick="switchDay(6)"><span>Sat</span><b id="val-6">£0</b></div>
    </div>

    <div class="main-container">
        <svg id="progress-ring" width="280" height="280">
            <circle id="bar" stroke="#FF8C00" stroke-width="12" fill="transparent" r="130" cx="140" cy="140" stroke-dasharray="816.8" stroke-dashoffset="816.8" stroke-linecap="round"/>
        </svg>
        <div class="center-circle" id="targetCircle">
            <span id="status-text" style="font-size:11px; font-weight:600; opacity:0.8;">REMAINING TARGET</span>
            <h1 id="targetDisplay">£380</h1>
        </div>
    </div>

    <div class="controls">
        <button class="btn-sale" onclick="handleSale()">+ SALE</button>
        <button class="btn-cost" onclick="handleCost()">+ COST</button>
    </div>

    <div class="report-actions">
        <button class="btn-report" onclick="generateReport()">WEEKLY SUMMARY</button>
        <button class="btn-reset" onclick="resetSelectedDay()">RESET VIEWED DAY</button>
    </div>

    <script>
        const BASE_TARGET = 380;
        let selectedDay = new Date().getDay();
        if(selectedDay === 0) selectedDay = 1;

        function getWk(d) { 
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate())); 
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7)); 
            var s = new Date(Date.UTC(d.getUTCFullYear(),0,1)); 
            return Math.ceil((((d-s)/86400000)+1)/7); 
        }

        let data = JSON.parse(localStorage.getItem('garageData'));
        const currentWk = getWk(new Date());

        if (!data || data.week !== currentWk) {
            data = { week: currentWk, days: {1:0,2:0,3:0,4:0,5:0,6:0}, targets: {1:BASE_TARGET,2:BASE_TARGET,3:BASE_TARGET,4:BASE_TARGET,5:BASE_TARGET,6:BASE_TARGET} };
        }

        function switchDay(d) {
            selectedDay = d;
            update();
        }

        function update() {
            const p = Number(data.days[selectedDay]) || 0;
            const t = Number(data.targets[selectedDay]) || BASE_TARGET;
            const r = t - p;

            const daysText = ["","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"];
            document.getElementById('viewing-label').innerText = "Viewing: " + daysText[selectedDay];

            const disp = document.getElementById('targetDisplay');
            const circ = document.getElementById('targetCircle');
            const stat = document.getElementById('status-text');

            if (r <= 0) {
                disp.innerText = "£" + Math.abs(r).toFixed(0);
                circ.classList.add('met');
                stat.innerText = "PROFIT ACHIEVED";
            } else {
                disp.innerText = "£" + r.toFixed(0);
                circ.classList.remove('met');
                stat.innerText = "REMAINING TARGET";
            }

            const bar = document.getElementById('bar');
            const circum = 130 * 2 * Math.PI;
            bar.style.strokeDashoffset = circum - (Math.min(p / t, 1) * circum);

            for (let i = 1; i <= 6; i++) {
                const dot = document.getElementById('day-' + i);
                const val = document.getElementById('val-' + i);
                const dayP = data.days[i] || 0;
                const dayT = data.targets[i] || BASE_TARGET;
                
                val.innerText = "£" + dayP.toFixed(0);
                dot.className = "day-circle";
                if (i === selectedDay) dot.classList.add('active');
                if (dayP >= dayT && dayP > 0) dot.classList.add('met');
                else if (dayP > 0) dot.classList.add('failed');
            }
            localStorage.setItem('garageData', JSON.stringify(data));
        }

        function handleSale() {
            const tot = prompt("Sale (£):");
            const cst = prompt("Parts (£):");
            if (tot && cst) {
                data.days[selectedDay] += (parseFloat(tot) - parseFloat(cst));
                update();
            }
        }

        function handleCost() {
            const ex = prompt("Extra Cost (£):");
            if (ex) {
                data.targets[selectedDay] += parseFloat(ex);
                update();
            }
        }

        function resetSelectedDay() {
            if(confirm("Reset " + document.getElementById('viewing-label').innerText + "?")) {
                data.days[selectedDay] = 0;
                data.targets[selectedDay] = BASE_TARGET;
                update();
            }
        }

        function generateReport() {
            let tp = 0; let tt = 0;
            for (let i = 1; i <= 6; i++) { tp += data.days[i]; tt += data.targets[i]; }
            alert("WEEKLY TOTALS\nProfit: £" + tp.toFixed(0) + "\nTarget: £" + tt);
        }

        update();
    </script>
</body>
</html>
